{{/* Hugo Blox: Contact */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $autolink := default true $block.content.autolink }}
{{ $data := $block.content }}

<section class="py-8 px-4 mx-auto max-w-screen-md sm:py-16 lg:px-6">
  {{ with $block.content.text }}<p>{{ . | emojify | $page.RenderString }}</p>{{ end }}
  <div class="mb-6">
    <form id="contact-form">
      <div class="mb-4">
        <label class="sr-only" for="inputCompanyName">{{ i18n "contact_company" }}</label>
        <input type="text" name="company" class="w-full p-2 border border-gray-300 rounded" id="inputCompanyName" placeholder="{{ i18n "contact_company" | default "Company Name" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputFirstName">{{ i18n "contact_first_name" }}</label>
        <input type="text" name="first_name" class="w-full p-2 border border-gray-300 rounded" id="inputFirstName" placeholder="{{ i18n "contact_first_name" | default "First Name" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputLastName">{{ i18n "contact_last_name" }}</label>
        <input type="text" name="last_name" class="w-full p-2 border border-gray-300 rounded" id="inputLastName" placeholder="{{ i18n "contact_last_name" | default "Last Name" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputEmail">{{ i18n "contact_email" }}</label>
        <input type="email" name="email" class="w-full p-2 border border-gray-300 rounded" id="inputEmail" placeholder="{{ i18n "contact_email" | default "Email" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputPhoneNumber">{{ i18n "contact_phone" }}</label>
        <input type="text" name="phone" class="w-full p-2 border border-gray-300 rounded" id="inputPhoneNumber" placeholder="{{ i18n "contact_phone" | default "Phone Number" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputWebsite">{{ i18n "contact_website" }}</label>
        <input type="url" name="website" class="w-full p-2 border border-gray-300 rounded" id="inputWebsite" placeholder="{{ i18n "contact_website" | default "Website" }}">
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputCountry">{{ i18n "contact_country" }}</label>
        <input type="text" name="country" class="w-full p-2 border border-gray-300 rounded" id="inputCountry" placeholder="{{ i18n "contact_country" | default "Country" }}">
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputCity">{{ i18n "contact_city" }}</label>
        <input type="text" name="city" class="w-full p-2 border border-gray-300 rounded" id="inputCity" placeholder="{{ i18n "contact_city" | default "City" }}">
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputSubject">{{ i18n "contact_subject" }}</label>
        <input type="text" name="subject" class="w-full p-2 border border-gray-300 rounded" id="inputSubject" placeholder="{{ i18n "contact_subject" | default "Subject" }}" required>
      </div>
      <div class="mb-4">
        <label class="sr-only" for="inputMessage">{{ i18n "contact_message" }}</label>
        <textarea name="message" class="w-full p-2 border border-gray-300 rounded" id="inputMessage" rows="5" placeholder="{{ i18n "contact_message" | default "Message" }}" required></textarea>
      </div>
      <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">
      <button type="submit" class="w-full py-2 px-4 bg-indigo-500 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-opacity-75">{{ i18n "contact_send" | default "Send" }}</button>
    </form>
  </div>

  <ul class="list-none">
    {{ if $data.email }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" "envelope" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
      <span id="person-email">
        {{- if $autolink }}<a href="mailto:{{ $data.email }}" class="text-blue-600">{{ $data.email }}</a>{{ else }}{{ $data.email }}{{ end -}}
      </span>
    </li>
    {{ end }}

    {{ with $data.phone }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" "phone" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
      <span id="person-telephone">
        {{- if $autolink }}<a href="tel:{{ . }}" class="text-blue-600">{{ . }}</a>{{ else }}{{ . }}{{ end -}}
      </span>
    </li>
    {{ end }}

    {{ $addr_formatted := "" }}{{/* Scoping for maps. */}}
    {{ if $data.address.street | or $data.address.city | or $data.address.region | or $data.address.postcode | or $data.address.country }}
      {{ $addr_formatted = partial "functions/get_address" (dict "root" . "address" $data.address) }}
      <li class="mb-2 flex items-center">
        {{ partial "functions/get_icon.html" (dict "name" "map-pin" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
        <span id="person-address">{{$addr_formatted}}</span>
      </li>
    {{ end }}

    {{ with $data.directions }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" "map" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
      <span>{{ . | markdownify | emojify }}</span>
    </li>
    {{ end }}

    {{ with $data.office_hours }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" "clock" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
      <span>
        {{- if not (reflect.IsSlice .)}}{{/* Support legacy string format. */}}
          {{- . | markdownify | emojify -}}
        {{else}}
          {{- delimit . "<br>" | markdownify | emojify -}}
        {{end -}}
      </span>
    </li>
    {{ end }}

    {{ with $data.appointment_url }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" "calendar" "pack" "hero" "attributes" "class=\"w-6 h-6 mr-2\"") }}
      <a href="{{ . }}" target="_blank" rel="noopener" class="text-blue-600">{{ i18n "book_appointment" | default "Book an appointment" }}</a>
    </li>
    {{ end }}

    {{/* Contact links. */}}
    {{ range $data.contact_links }}
    <li class="mb-2 flex items-center">
      {{ partial "functions/get_icon.html" (dict "name" .icon "pack" .icon_pack "attributes" "class=\"w-6 h-6 mr-2 text-blue-600\"") }}
      <a href="{{ .link }}" target="_blank" rel="noopener" class="text-blue-600">{{ .name }}</a>
    </li>
    {{ end }}
  </ul>

  <div id="map" class="w-full h-64 mt-4"></div>
</section>

<script>
  function initMap() {
    const mapOptions = {
      zoom: 15,
      center: { lat: 37.4275, lng: -122.1697 }
    };
    const map = new google.maps.Map(document.getElementById("map"), mapOptions);
    const marker = new google.maps.Marker({
      position: { lat: 37.4275, lng: -122.1697 },
      map: map,
    });
  }

  grecaptcha.ready(function() {
    grecaptcha.execute('6LfvTB0qAAAAAJKb-ayOnYI_fpA9ukwWIiU1ZL5X', {action: 'submit'}).then(function(token) {
      document.getElementById('g-recaptcha-response').value = token;
    });
  });

  document.getElementById('contact-form').addEventListener('submit', function(event) {
    event.preventDefault();
    grecaptcha.execute('6LfvTB0qAAAAAJKb-ayOnYI_fpA9ukwWIiU1ZL5X', {action: 'submit'}).then(function(token) {
      document.getElementById('g-recaptcha-response').value = token;

      const form = document.getElementById('contact-form');
      const formData = new FormData(form);
      fetch('https://email.raise.systems/sendemail', {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          // Clear the form
          form.reset();
          // Disable all inputs
          const inputs = form.querySelectorAll('input, textarea, button');
          inputs.forEach(input => input.disabled = true);        
          alert('Message sent successfully!');
        } else {
          alert('There was an error sending your message.');
        }
      })
      .catch(error => {
        alert('There was an error sending your message.');
      });
    });
  });
</script>

